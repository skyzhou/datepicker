/*! qdp 2014-09-25 */
(function(t){function e(t){var e=this;this.id=++m,this.element=t,this.date=new Date,this.begin=0,this.end=32495136761757,this.callback=null,this.selected=null,this.containerEl=document.createElement("div"),this.containerEl.style.display="none",this.barEl=document.createElement("div"),this.dayEl=document.createElement("ul"),this.dateEl=document.createElement("ul"),this.clearEl=document.createElement("div"),this.containerEl.appendChild(this.barEl),this.containerEl.appendChild(this.dayEl),this.containerEl.appendChild(this.dateEl),this.containerEl.appendChild(this.clearEl),this.containerEl.className="qdp-container",this.barEl.className="qdp-bar",this.dayEl.className="qdp-days",this.dateEl.className="qdp-dates",this.clearEl.style.clear="both",this.dayEl.innerHTML=a.tmpl(s,{days:h.days}),this.barEl.innerHTML=a.tmpl(r,h),this.yearEl=this.barEl.getElementsByTagName("label")[0],this.monthEl=this.barEl.getElementsByTagName("select")[0],this.monthEl.onchange=function(){e.setMonth(this.value)},a.event(this.barEl,"click",{prev:function(){e.setYear(e.date.getFullYear()-1)},next:function(){e.setYear(e.date.getFullYear()+1)}}),a.event(this.dateEl,"click",{ondate:function(){var t=this.innerText;e.setDate(t)}}),t.parentNode.appendChild(this.containerEl),a.on(t,"click",function(){var n=t.getAttribute("timestamp"),i=t.getAttribute("begin"),a=t.getAttribute("end"),o=t.getAttribute("group");e.show(function(n,i){t.value=n,t.setAttribute("timestamp",+i),e.influence(o)},{timestamp:n,begin:i,end:a})}),a.on(document.documentElement,"click",function(n,i){n=n||window.event,i=n.target||n.srcElement,e.containerEl.contains(i)||i===t||e.hide()}),t.setAttribute("qdp",this.id);var n=t.getAttribute("timestamp");n&&(this.selected=1*n,t.value=new Date(this.selected).toLocaleDateString())}function n(t){if(u||(a.insertStyle(o),u=!0),!t.getAttribute("qdp")){var n=t.getAttribute("group"),i=new e(t);n&&(g[n]||(g[n]=[]),g[n].push(i))}}function i(t){for(var e,i=0;e=t[i];i++)"date"==e.getAttribute("type")&&(e.type="text",n(e))}var a={};a.tmpl=function(){function t(t,e){if(e)for(var n in e){var i=RegExp("<%#"+n+"%>","g");t=t.replace(i,e[n])}return t}var e={};return function n(i,a,o){o=o||{};var r=o.key,s=o.mixinTmpl,l=!/\W/.test(i);r=r||(l?i:null);var d=r?e[r]=e[r]||n(t(l?document.getElementById(i).innerHTML:i,s)):Function("obj","var _p_=[],print=function(){_p_.push.apply(_p_,arguments);};with(obj){_p_.push('"+i.replace(/[\r\t\n]/g," ").split("\\'").join("\\\\'").split("'").join("\\'").split("<%").join("	").replace(/\t=(.*?)%>/g,"',$1,'").split("	").join("');").split("%>").join("_p_.push('")+"');}return _p_.join('');");return a?d(a):d}}(),a.insertStyle=function(t){var e=document.createElement("style");return e.type="text/css",document.getElementsByTagName("head")[0].appendChild(e),t&&(e.styleSheet?e.styleSheet.cssText=t:e.appendChild(document.createTextNode(t))),e.sheet||e},a.parseDate=function(t){var e=new Date(+t),n={};return n.year=e.getFullYear(),n.month=e.getMonth(),n.date=e.getDate(),e.setDate(1),n.emptys=e.getDay()?e.getDay()-1:6,n.first=+new Date(n.year,n.month,e.getDate()),e.setMonth(e.getMonth()+1),e.setDate(0),n.count=e.getDate(),n.last=+new Date(n.year,n.month,e.getDate()),n},a.on=function(t,e,n){t.addEventListener?t.addEventListener(e,n,!0):t.attachEvent&&t.attachEvent("on"+e,n)},function(){var t=function(t){return t.getAttribute("data-evt")},e=function(t){return!!t.getAttribute("data-evt")},n=function(t,n,i){i=i||this.judgeFn||e;for(var a=t.srcElement||t.target;a;){if(i(a))return a;if(n==a)break;a=a.parentNode}return null};a.event=function(e,i,o,r){r=r||t;var s=function(t){return!!r(t)},l=function(t){var i=n(t,e,s),a=!1;if(i){var l,d=r(i);"[object Function]"===Object.prototype.toString.call(o)?(l=o.call(i,t,d),a=!0):o[d]&&(l=o[d].call(i,t),a=!0),a&&(l||(t.preventDefault?t.preventDefault():t.returnValue=!1))}};a.on(e,i,l)}}();var o='.qdp-container{position:absolute;width:211px;min-height:183px;font-size:12px;font-family: Tahoma;border:1px solid #ccc;padding:1px;z-index:999;user-select: none;-webkit-user-select: none;}.qdp-container ul,.qdp-container li{list-style: none;padding:0px;margin:0px;}.qdp-bar{height:18px;border: 1px solid #EDEDED;background: #F1F1F1 url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAABkCAYAAABHLFpgAAAAI0lEQVQYlWP4+fPnfyYGBgaGIUT8//+fkBiCS7oETjuGCQEAOoIcmZfyoHUAAAAASUVORK5CYIIvKiAgfHhHdjAwfDM2OTUzYjI0MmU1NzNlMWE3OTgzMTMzMjlmZDg1MDEyICov) 50% 50% repeat-x;color: #222;font-weight: bold;width: 201px;position: relative;padding:4px;}.qdp-bar select{width: 72px;margin: 0px 5px;height:18px;vertical-align: middle;outline: none;}.qdp-prev,.qdp-next{display: block;cursor: pointer;margin:1px;font-family: Menlo, "Courier New",Courier,monospace;}.qdp-prev{float:left;}.qdp-next{float:right;}.qdp-bar ul{position:absolute;}.qdp-year{margin-left: 24px;position: relative;top: 1px;}.qdp-days{margin-top: 6px;}.qdp-days li{float:left;height:22px;width:30px;text-align:center;font-weight: bold;margin-top:6px;}.qdp-dates{clear:both;}.qdp-dates li{float:left;width:19px;height:20px;padding: 1px;margin:1px;text-align: right;line-height: 20px;text-align:right;line-height: 20px;padding-right: 6px;}.qdp-date-item{background:#E6E6E6 url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAGQCAYAAABvWArbAAAANUlEQVQ4je3LMQoAIBADwb38/6t5wFXaWAiCtUiaYZvF9hBACOFbuntVVe11B0CSjjeE8BwThQIJ8dhEl0YAAAAASUVORK5CYIIvKiAgfHhHdjAwfDJkMmY3OGEyZjJlYzlhZmNlMzM2YTQ4MGFkYzhhYmEwICov) 50% 50% repeat-x;border:1px solid #D3D3D3;cursor: pointer;color: #555;}.qdp-empty{background:#fff;border:1px solid #fff;}.qdp-date-item:hover{border:1px solid #707070;}.qdp-disable{background:#EAEAEA;border:1px solid #D3D3D3;cursor: not-allowed;color:#D4D4D4;}.qdp-today{border:1px solid #ccc;background: #FFF;}.qdp-selected{border:1px solid #707070;}',r='<a class="qdp-prev"  data-evt="prev">&#9668;</a><label class="qdp-year"></label><%=year%><select><% for(var i=0,mon;mon = months[i];i++){ %><option  data-evt="onmonth" value="<%=i%>"><%=mon%></option><% } %></select><%=month%><a class="qdp-next"  data-evt="next">&#9658;</a>',s="<% for(var i=0,day;day = days[i];i++){ %><li><%=day%></li><% } %>",l='<% for(var i=0;i<emptys;i++){ %><li  class="qdp-empty">&nbsp;</li><% } %><% for(var i=0,item;item=dates[i];i++){ %><li class="<%=item.cls%>"  data-evt="<%=item.evt%>"><%=item.date%></li><% } %>',d={"zh-cn":{months:["一","二","三","四","五","六","七","八","九","十","十一","十二"],days:["一","二","三","四","五","六","日"],year:"年",month:"月"},"zh-tw":{months:["壹","贰","叁","肆","伍","陆","柒","捌","玖","拾","拾壹","拾贰"],days:["壹","贰","叁","肆","伍","陆","日"],year:"年",month:"月"},"en-us":{months:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sept","Oct","Nov","Dec"],days:["Mon","Tues","Wed","Thur","Fri","Sat","Sun"],year:"&nbsp;",month:"&nbsp;"}},p=(navigator.language||navigator.browserLanguage||"en-us").toLowerCase(),h=d[p]?d[p]:d["en-us"],c=864e5,u=!1,g={},m=0,f=[];e.prototype.setMonth=function(t){this.date.setMonth(t),this.render()},e.prototype.setYear=function(t){this.date.setFullYear(t),this.render()},e.prototype.setDate=function(t){this.date.setDate(t),this.render(),this.callback(this.date.toLocaleDateString(),this.date),this.hide()},e.prototype.render=function(t){t=t||{};var e=a.parseDate(this.date),n=e.year,i=e.month,o=e.count,r=e.emptys,s=e.first,d=e.last,p=new Date,h=-1,u=[];p>s&&d>p&&(h=p.getDate());for(var g=0;o>g;g++){var m,f=s+864e5*g,y=g+1,b="qdp-date-item",E="ondate";(this.begin>f||f>this.end)&&(b="qdp-disable",E="ondisable"),h==g+1&&(b+=" qdp-today"),this.selected&&(m=this.selected-f,m>0&&c>m&&(b+=" qdp-selected")),u.push({date:y,cls:b,evt:E})}this.yearEl.innerHTML=n,this.monthEl.selectedIndex=i,this.dateEl.innerHTML=a.tmpl(l,{dates:u,emptys:r})},e.prototype.show=function(t,e){e=e||{},e.timestamp&&(this.date=new Date(1*e.timestamp),this.selected=e.timestamp),e.begin&&(this.begin=1*e.begin),e.end&&(this.end=1*e.end),this.callback=t,this.render(e),this.containerEl.style.left=this.element.offsetLeft+"px",this.containerEl.style.top=this.element.offsetTop+this.element.offsetHeight+"px",this.containerEl.style.display="block"},e.prototype.hide=function(){this.containerEl.style.display="none"},e.prototype.setRange=function(t,e){this.element.setAttribute("begin",t),this.element.setAttribute("end",e)},e.prototype.influence=function(t){if(t)for(var e,n=+this.date,i=0;e=g[t][i];i++)e.id<this.id?e.setRange("",n):e.id>this.id&&e.setRange(n-c,"")},a.on(window,"load",function(){f=document.getElementsByTagName("input"),i(f)}),window.define?define(function(t,e){e.toggle=function(){i(f)}}):(t.qdp=t.qdp||{},t.qdp.toggle=function(){i(f)})})(window);